"use strict";(self.webpackChunkroot=self.webpackChunkroot||[]).push([[911],{"./packages/react-auth-provider/dist/index.js":function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__rest=this&&this.__rest||function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthProvider=exports.useAuth=void 0;const react_1=__webpack_require__("./node_modules/react/index.js"),react_data_provider_1=__importStar(__webpack_require__("./packages/react-data-provider/dist/index.js")),react_2=__importStar(__webpack_require__("./node_modules/react/index.js")),AuthContext=(0,react_2.createContext)(null);exports.useAuth=()=>(0,react_2.useContext)(AuthContext);exports.AuthProvider=({children,onSuccess,onError})=>{const{post}=(0,react_data_provider_1.default)(),[user,setUser]=(0,react_2.useState)(),[accessToken,setAccessToken]=(0,react_2.useState)(),[refreshToken,setRefreshToken]=(0,react_2.useState)();(0,react_1.useEffect)((()=>{const _accessToken=localStorage.getItem("accessToken");setAccessToken(_accessToken)}),[]);const{execute,isPending}=(0,react_data_provider_1.useQuery)((loginData=>{const{loginPath}=loginData,bodyData=__rest(loginData,["loginPath"]);return post({uri:loginPath||"/auth/signin",body:bodyData})}),!1,{onSuccess:data=>{data&&(setAccessToken(data.accessToken),setRefreshToken(data.refreshToken),localStorage.setItem("accessToken",data.accessToken),localStorage.setItem("refreshToken",data.refreshToken),null==onSuccess||onSuccess(data.accessToken))},onError:error=>{console.error({error}),null==onError||onError(error)}});return react_2.default.createElement(AuthContext.Provider,{value:{user,setUser,doLogin:loginData=>__awaiter(void 0,void 0,void 0,(function*(){execute(loginData)})),doLogout:()=>__awaiter(void 0,void 0,void 0,(function*(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")})),isPending,accessToken,refreshToken}},children)}},"./packages/react-data-provider/dist/ClientProvider.js":function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.useClient=exports.ClientContext=void 0;const react_1=__importStar(__webpack_require__("./node_modules/react/index.js"));exports.ClientContext=(0,react_1.createContext)({baseUrl:"",onRefreshTokenError:()=>({})});exports.useClient=()=>(0,react_1.useContext)(exports.ClientContext);exports.default=({baseUrl:outerBaseUrl,onRefreshTokenError,children})=>{const[baseUrl,setBaseUrl]=(0,react_1.useState)();return(0,react_1.useEffect)((()=>{outerBaseUrl&&setBaseUrl(outerBaseUrl)}),[outerBaseUrl]),react_1.default.createElement(exports.ClientContext.Provider,{value:{baseUrl,onRefreshTokenError}},children)}},"./packages/react-data-provider/dist/axiosClient.js":function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const axios_1=__importDefault(__webpack_require__("./node_modules/axios/index.js"));let axiosInstance,defaultConfigs;const axiosClient={executeRequest:configs=>{if(!axiosInstance)throw"You need to create a http client instance with default config";return axiosInstance.request(Object.assign(Object.assign(Object.assign({},configs),{url:configs.uri,params:configs.queryParams,signal:configs.signal}),"body"in configs&&{data:configs.body})).then((response=>{const{config,data,headers,status}=response;return{config,data,headers,status}})).catch((error=>{throw{code:error.code,message:error.message,response:error.response}}))},applyMiddleware:middlewares=>{if(!axiosInstance)throw"You need to create a http client instance with default config";axiosInstance.interceptors.request.use((config=>__awaiter(void 0,void 0,void 0,(function*(){var _a;if(config.url&&-1===defaultConfigs.skipAuthUris.findIndex((uri=>{var _a;return null===(_a=null==config?void 0:config.url)||void 0===_a?void 0:_a.includes(uri)}))){const accessToken=null===(_a=null==middlewares?void 0:middlewares.getAccessToken)||void 0===_a?void 0:_a.call(middlewares);return config.headers&&(config.headers.Authorization=`Bearer ${accessToken}`),Promise.resolve(config)}return Promise.resolve(config)}))),(error=>__awaiter(void 0,void 0,void 0,(function*(){return Promise.reject(error)})))),axiosInstance.interceptors.response.use((response=>response),(error=>__awaiter(void 0,void 0,void 0,(function*(){var _b;const config=null==error?void 0:error.config;if(config.url&&-1===defaultConfigs.skipAuthUris.findIndex((uri=>{var _a;return null===(_a=null==config?void 0:config.url)||void 0===_a?void 0:_a.includes(uri)}))&&401===(null===(_b=null==error?void 0:error.response)||void 0===_b?void 0:_b.status)&&!(null==config?void 0:config._sent)){config._sent=!0;const response=yield middlewares.getNewToken();return response&&"accessToken"in response&&"refreshToken"in response?(config.headers&&(config.headers.Authorization=`Bearer ${response.accessToken}`),axiosInstance(config)):Promise.reject(error)}return Promise.reject(error)}))))},defaultConfig:defaultConfig=>{axiosInstance=axios_1.default.create(defaultConfig),defaultConfigs=defaultConfig}};exports.default=axiosClient},"./packages/react-data-provider/dist/index.js":function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.useQuery=exports.ClientProvider=void 0;const react_1=__webpack_require__("./node_modules/react/index.js"),useDataProvider_1=__importDefault(__webpack_require__("./packages/react-data-provider/dist/useDataProvider.js")),ClientProvider_1=__importDefault(__webpack_require__("./packages/react-data-provider/dist/ClientProvider.js"));exports.ClientProvider=ClientProvider_1.default;const interfaces_1=__webpack_require__("./packages/react-data-provider/dist/interfaces/index.js");exports.useQuery=(asyncFn,immediate=!1,options,arg)=>{const[status,setStatus]=(0,react_1.useState)(interfaces_1.AsyncStatus.idle),[data,setData]=(0,react_1.useState)(),[error,setError]=(0,react_1.useState)(),[isPending,setIsPending]=(0,react_1.useState)(!1),{onError,onSuccess,onFinish,formatData}=options||{},execute=(0,react_1.useCallback)((_arg=>__awaiter(void 0,void 0,void 0,(function*(){setStatus(interfaces_1.AsyncStatus.pending),setIsPending(!0),setError(void 0);try{const response=yield asyncFn(_arg),formattedData=formatData?formatData(response):response;setData(formattedData),setStatus(interfaces_1.AsyncStatus.success),null==onSuccess||onSuccess(formattedData),null==onFinish||onFinish(interfaces_1.AsyncStatus.success)}catch(err){setError(err),setStatus(interfaces_1.AsyncStatus.error),null==onError||onError(err),null==onFinish||onFinish(interfaces_1.AsyncStatus.error)}finally{setIsPending(!1)}}))),[asyncFn]),refresh=(0,react_1.useCallback)((()=>execute(arg)),[execute]);return(0,react_1.useEffect)((()=>{immediate&&execute(arg)}),[immediate]),{execute,status,isPending,data,error,refresh}},exports.default=useDataProvider_1.default},"./packages/react-data-provider/dist/interfaces/index.js":(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AsyncStatus=void 0,function(AsyncStatus){AsyncStatus.pending="pending",AsyncStatus.success="success",AsyncStatus.error="error",AsyncStatus.idle="idle"}(exports.AsyncStatus||(exports.AsyncStatus={}))},"./packages/react-data-provider/dist/useDataProvider.js":function(__unused_webpack_module,exports,__webpack_require__){var process=__webpack_require__("./node_modules/process/browser.js"),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const memoizee_1=__importDefault(__webpack_require__("./node_modules/memoizee/index.js")),axiosClient_1=__importDefault(__webpack_require__("./packages/react-data-provider/dist/axiosClient.js")),ClientProvider_1=__webpack_require__("./packages/react-data-provider/dist/ClientProvider.js");exports.default=()=>{const{baseUrl,onRefreshTokenError}=(0,ClientProvider_1.useClient)(),envBaseUrl=process.env.NEXT_PUBLIC_API_URL,_baseUrl=baseUrl||envBaseUrl,client=axiosClient_1.default,refreshAccessToken=(0,memoizee_1.default)((()=>__awaiter(void 0,void 0,void 0,(function*(){try{const refreshToken=localStorage.getItem("refreshToken"),response=yield post({uri:"/token/refresh",body:{refreshToken}});return(null==response?void 0:response.accessToken)&&(null==response?void 0:response.refreshToken)&&(localStorage.setItem("accessToken",response.accessToken),localStorage.setItem("refreshToken",response.refreshToken)),Promise.resolve(response)}catch(error){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),null==onRefreshTokenError||onRefreshTokenError(error),Promise.reject(error)}}))),{maxAge:1e4});client.defaultConfig({baseURL:_baseUrl,skipAuthUris:["login","refresh"],headers:{"Content-Type":"application/json"}}),client.applyMiddleware({getAccessToken:()=>{const accessToken=localStorage.getItem("accessToken");if(accessToken)return accessToken},getNewToken:()=>__awaiter(void 0,void 0,void 0,(function*(){return yield refreshAccessToken()}))});const makeRequest=requestParams=>client.executeRequest(requestParams).then((res=>handleServerResponse(res))).catch((err=>handleServerError(err))),handleServerResponse=response=>{const{config,data,headers,status}=response;return data},handleServerError=err=>{const{code,response,message}=err;throw err},post=requestParams=>__awaiter(void 0,void 0,void 0,(function*(){return makeRequest(Object.assign(Object.assign({},requestParams),{method:"POST"}))}));return{post,get:requestParams=>__awaiter(void 0,void 0,void 0,(function*(){return makeRequest(Object.assign(Object.assign({},requestParams),{method:"GET"}))})),put:requestParams=>__awaiter(void 0,void 0,void 0,(function*(){return makeRequest(Object.assign(Object.assign({},requestParams),{method:"PUT"}))})),patch:requestParams=>__awaiter(void 0,void 0,void 0,(function*(){return makeRequest(Object.assign(Object.assign({},requestParams),{method:"PATCH"}))})),del:requestParams=>__awaiter(void 0,void 0,void 0,(function*(){return makeRequest(Object.assign(Object.assign({},requestParams),{method:"DELETE"}))}))}}}}]);